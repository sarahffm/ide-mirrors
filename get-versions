#!/usr/bin/env bash

for software in */;
do
  if [ "${software}" = "oc/" ]
  then
    software=${software::-1}
    versions_url="./${software}/versions-url"
    versions_url_op="./${software}/versions-url-op"
    subdir_count=$(find "./${software}" -maxdepth 1 -type d | wc -l)

    chmod +x ./${software}/*

    if [ "${subdir_count}" -eq 1 ]
    then
      if grep -s -q "https://api.github.com/repos" "${versions-url}"
      then
        curl -s "${versions_url}" | awk -F "\"" '/tag_name/ {print $4}' | sort -V -r > "./${software}/available_versions"
      else 
        eval "curl -s "${versions_url}" | "${versions_url_op}"" > "./${software}/available_versions"
      fi
    else
      # TODO
      echo "Subdirectories for providers present."
    fi
    # debug
    echo "Availabel versions:"
    cat "./${software}/available_versions"
  fi
done
